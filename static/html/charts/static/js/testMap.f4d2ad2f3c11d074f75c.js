webpackJsonp([13],{104:function(e,t,n){"use strict";var a=n(286),r=(n.n(a),n(171)),o=(n.n(r),n(81)),i=n(37),u=n(78),c=n(79);t.a={load:function(e){var t=this;i.a.merge(c.a),i.a.merge(e.config),u.a.merge(e.apis),t.initZoom(),e.init()},initZoom:function(){i.a.get("zoom")&&(n.i(o.a)(),window.addEventListener("resize",o.b),n.i(o.b)())}}},1167:function(e,t,n){e.exports=n.p+"static/img/header.fd3cfab.png"},132:function(e,t,n){"use strict";function a(e,t){return function(n){!0===n?e():setTimeout(e,t)}}n.d(t,"a",function(){return i}),t.b=a;var r=n(9),o=n.n(r),i=function(e){var t=n(173),a=t({data:e});return o()(".error-dialog").html(a),o()("#errorDialog").fadeIn(50),o()("#errorDialog").on("click",".close-model",function(e){e.stopPropagation(),e.preventDefault(),o()("#errorDialog").fadeOut(50),o()(".error-dialog").empty()}),!1}},133:function(e,t,n){"use strict";function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments[2];2===arguments.length&&n.i(y.a)(t)&&(a=t,t={});var r=v.a.config(e),o={},u=v.a.filterData(e,t);if(r.contentType){var s=r.contentType;if(-1!=s.indexOf("application/json"))u=l()(u);else if(-1!=s.indexOf("multipart/form-data")){o.contentType=!1,o.processData=!1;var f=new FormData;c()(u).forEach(function(e){var t=u[e];n.i(y.b)(t)?t.forEach(function(t){f.append(e,t)}):f.append(e,t)}),o.data=f}}return p.a.ajax(i()({url:v.a.url(e,t),dataType:"json",data:u},r,o)).done(function(e){if(!e.code)return n.i(d.a)("调后台接口失败:"+e.msg);a&&a(e.result)}).fail(function(){return n.i(d.a)("请求失败: 系统错误")})}function r(e,t,r,o){var i=arguments.length,u=g.a.get("fetchInterval");2===i?(r=t,t=null,o=null):3===i&&(n.i(y.a)(r)?o=null:n.i(y.c)(r)&&(o=r,r=t,t=null)),t=t||{},o=o||u;var c=!1,s=n.i(d.b)(function(){c||a(e,t,r).always(s)},o);return s(!0),{close:function(){c=!0}}}t.a=a,t.b=r;var o=n(52),i=n.n(o),u=n(135),c=n.n(u),s=n(134),l=n.n(s),f=n(9),p=n.n(f),d=n(132),y=n(80),v=n(78),g=n(37),h=n(295);n.n(h)},171:function(e,t){},172:function(e,t){},173:function(e,t,n){var a=n(7);e.exports=(a.default||a).template({compiler:[7,">= 4.0.0"],main:function(e,t,n,a,r){var o;return'<div class="model-bg" id="errorDialog">\r\n  <div class="model-container">\r\n    <div class="model-body">'+e.escapeExpression((o=null!=(o=n.data||(null!=t?t.data:t))?o:n.helperMissing,"function"==typeof o?o.call(null!=t?t:e.nullContext||{},{name:"data",hash:{},data:r}):o))+'</div>\r\n        \r\n    <div class="close-model"></div>\r\n  </div>\r\n</div>'},useData:!0})},191:function(e,t,n){"use strict";t.a={MAP_TILE_URL:"https://api.mapbox.com/styles/v1/baizn/cj60h9n5b1o1t2smjct2ack3d/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiYmFpem4iLCJhIjoiY2o1aXkxbDk4MWwwaDMzbW5oaDNxN240bCJ9.RKUQwXa57CuEaYhZBafuqw",CENTER_VIEW:[13046665.245916,4739506.713976609],MAP_ZOOM:13}},335:function(e,t,n){"use strict";var a=n(2),r=n.n(a),o=n(3),i=n.n(o),u=n(373),c=n(371),s=n(370),l=n(372),f=n(369),p=n(133),d=n(76),y=n.n(d),v=new y.a.format.GeoJSON({featureProjection:"EPSG: 3857"}),g=function(){function e(){r()(this,e);var t=new u.a("map");this.mapInstance=t.getMapInstance(),this.pointsLayer=new c.a,this.personHeaderLayer=new s.a,this.popup=new l.a("popup"),this.blurPointsLayer=new f.a;var n=this.blurPointsLayer.getLayer();this.mapInstance.addLayer(n);var a=this.pointsLayer.getLayer();this.mapInstance.addLayer(a);var o=this.personHeaderLayer.getLayer();this.mapInstance.addLayer(o);var i=this.popup.getOverlay();this.mapInstance.addOverlay(i)}return i()(e,[{key:"renderPoints",value:function(){var e=this;n.i(p.a)("MapPointsFetch",function(t){var n=v.readFeatures(t);e.pointsLayer.addFeatures(n),e.pointsLayer.updateStyle()})}},{key:"renderPersonHeader",value:function(){var e=this;n.i(p.b)("RealHeaderFetch",function(t){var n=v.readFeatures(t);e.personHeaderLayer.addFeatures(n),e.personHeaderLayer.updateStyle(),setTimeout(function(){n.forEach(function(t){t.get("isVisibiled")||e.personHeaderLayer.removeFeature(t)})},4e3)},5e3)}},{key:"bindClickEvent",value:function(){var e=this,t=e.mapInstance;t.on("pointermove",function(e){var n=t.hasFeatureAtPixel(e.pixel);t.getViewport().style.cursor=n?"pointer":""}),t.on("singleclick",function(n){var a=t.forEachFeatureAtPixel(n.pixel,function(e,t){return{feature:e,layer:t}}),r=a.feature,o=a.layer;if(!r)return!1;var i=o===e.pointsLayer.getLayer();i&&e.blurPointsLayer.addFeature(r),r.set("isVisibiled",!0),e.popup.closePopup("popup-closer",function(){r.set("isVisibiled",!1),i?e.blurPointsLayer.removeFeature(r):e.personHeaderLayer.removeFeature(r),t.removeOverlay(e.popup)}),document.getElementById("popup-content").innerHTML="<p>You name:</p><code>"+r.get("name")+"</code>",e.popup.getOverlay().setPosition(n.coordinate)})}}]),e}();t.a=g},336:function(e,t,n){"use strict";var a=n(374),r=n(375);t.a={MapPointsFetch:a.a,RealHeaderFetch:r.a}},338:function(e,t){},368:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(104),r=n(336),o=n(338),i=(n.n(o),n(191)),u=n(335);a.a.load({apis:r.a,config:i.a,init:function(){var e=new u.a;e.renderPoints(),e.renderPersonHeader(),e.bindClickEvent()}})},369:function(e,t,n){"use strict";var a=n(2),r=n.n(a),o=n(3),i=n.n(o),u=n(76),c=n.n(u),s=function(e,t,n){var a=document.createElement("canvas"),r=Math.ceil(e+1.3*n),o=2*r;a.width=o,a.height=o;var i=a.getContext("2d");return i.shadowColor=t,i.shadowBlur=n,i.fillStyle=t,i.beginPath(),i.arc(r,r,e,0,2*Math.PI),i.closePath(),i.fill(),a},l=function(){function e(){r()(this,e),this.layer=new c.a.layer.Vector({source:new c.a.source.Vector,style:function(e){var t=10;t=e.get("age")>80?15:e.get("age")>40?10:5;var n=s(t,"#fff",10);return new c.a.style.Style({image:new c.a.style.Icon({img:n,imgSize:[n.width,n.height]})})}})}return i()(e,[{key:"getLayer",value:function(){return this.layer}},{key:"addFeature",value:function(e){this.getLayer().getSource().addFeature(e)}},{key:"removeFeature",value:function(e){this.getLayer().getSource().removeFeature(e)}}]),e}();t.a=l},37:function(e,t,n){"use strict";var a=n(52),r=n.n(a),o={};t.a={merge:function(e){o=r()({},o,e)},get:function(e){return o[e]}}},370:function(e,t,n){"use strict";var a=n(2),r=n.n(a),o=n(3),i=n.n(o),u=n(76),c=n.n(u),s=n(1167),l=n.n(s),f=function(){function e(){r()(this,e),this.personHeaderLayer=new c.a.layer.Vector({source:new c.a.source.Vector}),this.source=this.personHeaderLayer.getSource()}return i()(e,[{key:"getLayer",value:function(){return this.personHeaderLayer}},{key:"addFeatures",value:function(e){this.source.addFeatures(e)}},{key:"removeFeature",value:function(e){this.source.removeFeature(e)}},{key:"updateStyle",value:function(){this.personHeaderLayer.setStyle(function(e){return new c.a.style.Style({image:new c.a.style.Icon({anchorXUnits:"pixels",anchorYUnits:"pixels",src:e.get("img")||l.a})})})}},{key:"show",value:function(){this.personHeaderLayer.setVisible(!0)}},{key:"hide",value:function(){this.personHeaderLayer.setVisible(!1)}}]),e}();t.a=f},371:function(e,t,n){"use strict";var a=n(2),r=n.n(a),o=n(3),i=n.n(o),u=n(76),c=n.n(u),s=function(){function e(){r()(this,e),this.pointsLayer=new c.a.layer.Vector({source:new c.a.source.Vector,layerName:"points"})}return i()(e,[{key:"getLayer",value:function(){return this.pointsLayer}},{key:"addFeatures",value:function(e){var t=this.pointsLayer.getSource();e&&(t.clear(),t.addFeatures(e))}},{key:"removeFeatures",value:function(e){this.pointsLayer.getSource().removeFeature(e)}},{key:"updateStyle",value:function(){this.pointsLayer.setStyle(function(e){var t=10,n="",a="";return e.get("age")>80?(t=15,n="#bbbf1e",a="#ddd91c"):e.get("age")>40?(t=10,n="#a23837",a="#d9493d"):(t=5,n="#02db72",a="#08c36d"),new c.a.style.Style({image:new c.a.style.Circle({radius:t,fill:new c.a.style.Fill({color:n}),stroke:new c.a.style.Stroke({color:a,width:3})})})})}}]),e}();t.a=s},372:function(e,t,n){"use strict";var a=n(2),r=n.n(a),o=n(3),i=n.n(o),u=n(76),c=n.n(u),s=function(){function e(t){r()(this,e);var n="string"==typeof t?document.getElementById(t):t;this.overlay=new c.a.Overlay({element:n,autoPan:!0,autoPanAnimation:{duration:250}})}return i()(e,[{key:"getOverlay",value:function(){return this.overlay}},{key:"closePopup",value:function(e,t){var n="string"==typeof e?document.getElementById(e):e,a=this;n.onclick=function(){return a.overlay.setPosition(void 0),n.blur(),t&&t(),!1}}}]),e}();t.a=s},373:function(e,t,n){"use strict";var a=n(2),r=n.n(a),o=n(3),i=n.n(o),u=n(76),c=n.n(u),s=n(828),l=(n.n(s),n(191)),f=function(){function e(t){r()(this,e),this.map=new c.a.Map({layers:[new c.a.layer.Tile({source:new c.a.source.XYZ({url:l.a.MAP_TILE_URL})})],target:t,controls:c.a.control.defaults({attributionOptions:{collapsible:!1}}),view:new c.a.View({center:l.a.CENTER_VIEW,zoom:l.a.MAP_ZOOM})})}return i()(e,[{key:"getMapInstance",value:function(){return this.map}}]),e}();t.a=f},374:function(e,t,n){"use strict";var a=n(124),r=n.n(a),o=r.a.Random,i=[13034588.195446936,4743787.187560575,13060615.003578058,4733162.440628944],u=function(e,t){for(var n=t,a={type:"FeatureCollection",crs:{type:"name",properties:{name:"EPSG: 4326"}},features:[]},r=a.features;n--;)r.push({type:"Feature",geometry:{type:"Point",coordinates:[o.float(e[0],e[2]),o.float(e[1],e[3])]},properties:{name:o.cname(),type:[o.pick(["涉恐","涉毒"])],gender:o.pick("男","女"),age:o.integer(30,100),nation:o.cword(2)+"族",nativePlace:o.city(),idCard:o.id(),portrait:o.image("51x75")}});return a}(i,Math.floor(100*Math.random()));t.a={url:"/points",mock:{code:1,msg:"success",result:u}}},375:function(e,t,n){"use strict";function a(){for(var e={type:"FeatureCollection",crs:{type:"name",properties:{name:"EPSG:4326"}},features:[]},t=e.features,n=u.integer(2,5);n--;)t.push({type:"Feature",properties:o.a.mock({portrait:'@image("40x59")',name:"@cname",gender:Math.random()>.5?"男":"女",nation:"@cword(2)族","age|20-50":1,time:'@date("yyyy-MM-dd HH:mm")',location:"@county(true)",reason:"@csentence",type:"@cword(2, 3)"}),geometry:{type:"Point",coordinates:[u.float(i[0],i[2]),u.float(i[1],i[3])]}});return e}var r=n(124),o=n.n(r),i=[13034588.195446936,4743787.187560575,13060615.003578058,4733162.440628944],u=o.a.Random;t.a={url:"/realHeader",mock:{code:1,msg:"success",result:function(){return a()}}}},78:function(e,t,n){"use strict";(function(e){function a(e,t){var n=e;if(n&&-1!==n.indexOf("//"))return n;null===n&&(n=""),n=location.host+n;var a=location.protocol;if(t){var r="ws://";"https:"===a&&(r="wss://"),n=r+n}else n=a+"//"+n;return n}var r=n(52),o=n.n(r),i=n(124),u=n.n(i),c=n(37),s=n(80),l={},f=/:([^\/\d][^\/]+)/g;t.a={merge:function(e){var t=this,n=void 0,r=void 0,o=c.a.get("mock");c.a.get("proxy")?(n=c.a.get("proxyHost"),r=c.a.get("websocketProxyHost")):(n=a(c.a.get("host")),r=a(c.a.get("websocketHost"),!0));for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)&&{}.hasOwnProperty.call(e,i)){var s=!1,f=e[i],p=f.config||{},d=f.url;!0===f.isWebsocket&&(s=!0),p.type||(p.type="get"),p.type=p.type.toLowerCase(),l[i]={url:(s?r:n)+d,config:p},o&&f.mock&&u.a.mock(t.reg(i),p.type,f.mock)}},rawUrl:function(e){return l[e].url},url:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.rawUrl(t).replace(f,function(t,a){var r=n[a];return void 0===r&&(r="null"),e.encodeURIComponent(r)})},reg:function(e){var t=this,n=t.rawUrl(e),a=n.replace(/\./g,"\\.").replace(f,"[^/]+");return new RegExp("^"+a+"(\\?.*)?$")},config:function(e){return l[e]&&l[e].config},filterData:function(e,t){var a=this;if(!n.i(s.d)(t))return t;for(var r=o()({},t),i=a.rawUrl(e),u=void 0;u=f.exec(i);){delete r[u[1]]}return r}}}).call(t,n(27))},79:function(e,t,n){"use strict";(function(e){var n=e.location.search;t.a={mock:-1===n.indexOf("mock"),mockInterval:3500,fetchInterval:3e3,proxy:-1!==n.indexOf("proxy"),host:"/api",websocketHost:"ws://online.com",proxyHost:"http://192.168.1.199:3000/api",websocketProxyHost:"ws://offline.com",mapHost:"http://192.168.1.16:10088/mapdata/cq",zoom:!1,pageWidth:1920,pageHeight:1080}}).call(t,n(27))},80:function(e,t,n){"use strict";function a(e,t){return Object.prototype.toString.call(e)==="[object "+t+"]"}function r(e){return a(e,"Object")}function o(e){return a(e,"Function")}function i(e){return a(e,"Number")}function u(e){return a(e,"Array")}t.d=r,t.a=o,t.c=i,t.b=u},81:function(e,t,n){"use strict";function a(){var e=window.innerWidth/u.a.get("pageWidth"),t=window.innerHeight/u.a.get("pageHeight");f=[e,t],l.css("transform","scale("+e+", "+t+")")}function r(){l.addClass("zoomify").css("width",u.a.get("pageWidth")).css("height",u.a.get("pageHeight"))}function o(e){return[e[0]*f[0],e[1]*f[1]]}t.b=a,t.a=r,t.c=o;var i=n(172),u=(n.n(i),n(37)),c=n(9),s=n.n(c),l=s()("body"),f=[1,1]}},[368]);
//# sourceMappingURL=testMap.f4d2ad2f3c11d074f75c.js.map